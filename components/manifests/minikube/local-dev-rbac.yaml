---
# ServiceAccount for mock local development user
apiVersion: v1
kind: ServiceAccount
metadata:
  name: local-dev-user
  namespace: ambient-code
  labels:
    app: ambient-local-dev
---
# Role with necessary permissions for local development
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: local-dev-user
  namespace: ambient-code
spec:
  rules:
  # ProjectSettings CRD access
  - apiGroups: ["vteam.ambient-code"]
    resources: ["projectsettings"]
    verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
  
  # AgenticSessions CRD access
  - apiGroups: ["vteam.ambient-code"]
    resources: ["agenticsessions"]
    verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
  
  # RFE Workflows CRD access
  - apiGroups: ["vteam.ambient-code"]
    resources: ["rfeworkflows"]
    verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
  
  # Core resources
  - apiGroups: [""]
    resources: ["namespaces", "pods", "services", "secrets", "serviceaccounts", "configmaps"]
    verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
  
  # Jobs
  - apiGroups: ["batch"]
    resources: ["jobs"]
    verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
---
# RoleBinding for local dev user
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: local-dev-user
  namespace: ambient-code
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: local-dev-user
subjects:
- kind: ServiceAccount
  name: local-dev-user
  namespace: ambient-code
---
# ClusterRole for cross-namespace operations (minimal)
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: local-dev-namespace-viewer
rules:
# Only allow viewing namespaces (for project list)
- apiGroups: [""]
  resources: ["namespaces"]
  verbs: ["get", "list", "watch"]
---
# ClusterRoleBinding for namespace viewing
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: local-dev-namespace-viewer
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: local-dev-namespace-viewer
subjects:
- kind: ServiceAccount
  name: local-dev-user
  namespace: ambient-code

