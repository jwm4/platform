apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: vteam-dev

# Resources (base + local-dev-specific)
resources:
- ../../base
- build-configs.yaml
- dev-users.yaml
- frontend-auth.yaml
- backend-route.yaml
- frontend-route.yaml
- operator-config-crc.yaml

# Patches for local dev environment
patches:
# Strategic merge patches
- path: backend-deployment-patch.yaml
- path: frontend-deployment-patch.yaml
- path: operator-patch.yaml
- path: pvc-patch.yaml
- path: backend-clusterrole-patch.yaml
- path: operator-clusterrole-patch.yaml
# PostgreSQL: use RHEL image with proper env vars and mount paths (JSON patch)
- path: postgresql-json-patch.yaml
  target:
    group: apps
    version: v1
    kind: Deployment
    name: postgresql

# Name prefix for local dev resources
namePrefix: vteam-

# Images for local dev (internal registry)
images:
- name: quay.io/ambient_code/vteam_backend
  newName: image-registry.openshift-image-registry.svc:5000/vteam-dev/vteam-backend
  newTag: latest
- name: quay.io/ambient_code/vteam_frontend
  newName: image-registry.openshift-image-registry.svc:5000/vteam-dev/vteam-frontend
  newTag: latest
- name: quay.io/ambient_code/vteam_operator
  newName: image-registry.openshift-image-registry.svc:5000/vteam-dev/vteam-operator
  newTag: latest
- name: quay.io/ambient_code/vteam_claude_runner
  newName: quay.io/ambient_code/vteam_claude_runner
  newTag: latest
# PostgreSQL: RHEL image handled via JSON patch (postgresql-json-patch.yaml)
